# 時間割変更システム - プロジェクト設計サマリー

## プロジェクト概要

**システム名称**: 時間割変更システム  
**目的**: 高専の時間割変更申請を効率化し、重複エラーの自動チェック、承認・管理、学生への周知を一括して行えるWebベースのシステム  
**納期**: プロトタイプ6月上旬、完成7月下旬  

## 承認済み技術スタック

### フロントエンド
- **フレームワーク**: React v19.1.0
- **言語**: TypeScript
- **UIライブラリ**: Material-UI v7.0.1
- **状態管理**: React Context API
- **ルーティング**: React Router
- **HTTP通信**: Axios

### バックエンド
- **言語**: Go (1.24.4)
- **フレームワーク**: Echo
- **データベースアクセス**: Squirrel (SQLビルダー)
- **認証**: JWT + bcrypt
- **メール送信**: gomail + Postfix

### データベース
- **RDBMS**: MariaDB 10.11
- **対象範囲**: 5学年×5クラス、月～金最大4コマ/日

### インフラ
- **コンテナ**: Docker + Docker Compose
- **OS**: Ubuntu 24.04
- **メールサーバー**: Postfix (契約済みサーバー・ドメイン使用)

## 確定プロジェクト構造

```
timetable-change-system/
├── frontend/                  # React + TypeScript
│   ├── public/
│   ├── src/
│   │   ├── components/
│   │   │   ├── auth/         # 認証関連コンポーネント
│   │   │   ├── timetable/    # 時間割関連コンポーネント
│   │   │   ├── request/      # 申請関連コンポーネント
│   │   │   ├── admin/        # 管理者関連コンポーネント
│   │   │   ├── student/      # 学生関連コンポーネント
│   │   │   └── common/       # 共通コンポーネント
│   │   ├── contexts/         # React Context
│   │   ├── services/         # API通信サービス
│   │   ├── types/            # TypeScript型定義
│   │   ├── utils/            # ユーティリティ関数
│   │   ├── App.tsx
│   │   └── main.tsx
│   ├── package.json
│   └── Dockerfile
│
├── backend/                   # Go + Echo
│   ├── cmd/
│   │   └── main.go           # アプリケーションエントリーポイント
│   ├── internal/
│   │   ├── api/              # APIハンドラー
│   │   │   ├── auth/         # 認証API
│   │   │   ├── timetable/    # 時間割API
│   │   │   ├── request/      # 申請API
│   │   │   ├── admin/        # 管理者API
│   │   │   └── student/      # 学生API
│   │   ├── models/           # データモデル
│   │   ├── services/         # ビジネスロジック
│   │   ├── middleware/       # ミドルウェア
│   │   ├── config/           # 設定管理
│   │   └── utils/            # ユーティリティ
│   ├── migrations/           # データベースマイグレーション
│   ├── tests/                # テストファイル
│   ├── go.mod
│   ├── go.sum
│   └── Dockerfile
│
├── docs/                      # ドキュメント
│   ├── test-specifications.md # テスト仕様書
│   └── api-documentation.md   # API仕様書
│
├── docker-compose.yml         # Docker構成
├── README.md
└── project-design-summary.md
```

## 番号付きタスクリスト（優先順位付き）

### フェーズ1: 基盤機能（5月中旬～5月下旬）

**1. プロジェクト基盤構築**
- Go Echo プロジェクト初期化
- MySQL データベース設計・作成
- Docker環境の調整（MySQL対応）
- 基本的なAPI構造の構築

**2. 認証システム実装**
- JWT認証機能実装
- メールアドレスベースログイン
- ユーザー権限管理（管理者/教員/学生）
- パスワードハッシュ化（bcrypt）

**3. 基本データモデル実装**
- ユーザーテーブル設計・実装
- 科目テーブル設計・実装
- クラステーブル設計・実装
- 時間割テーブル設計・実装
- 変更申請テーブル設計・実装

### フェーズ2: 核心機能（6月上旬～6月中旬）

**4. 時間割表示機能**
- 時間割一覧API実装
- フィルタリング機能（学年/クラス/曜日）
- フロントエンド時間割表示コンポーネント
- レスポンシブデザイン対応

**5. CSV機能実装**
- 担当者データインポート機能
- 時間割データインポート機能
- データエクスポート機能
- CSVバリデーション機能

**6. 変更申請機能**
- 申請フォーム作成
- 重複チェックロジック実装
- 申請データ保存機能
- 申請状態管理

### フェーズ3: 高度機能（6月下旬～7月上旬）

**7. 承認・管理機能**
- 申請一覧表示機能
- 承認/却下機能
- 多段階承認フロー
- 状態管理システム

**8. メール通知機能**
- Postfix連携設定
- 申請通知メール機能
- 承認/却下通知メール機能
- 時間割変更通知メール機能

**9. 授業回数チェック機能**
- 授業回数カウント機能
- 前期/後期/通年の回数管理
- 不足回数アラート機能

### フェーズ4: 最終調整（7月中旬～7月下旬）

**10. 学生機能実装**
- 学生用時間割表示機能
- 学生用通知受信機能
- 学生用フィルタリング機能

**11. 性能最適化**
- データベースインデックス最適化
- API応答時間改善（目標1秒以内）
- フロントエンド最適化（目標3秒以内）

**12. テスト仕様書作成・テスト実行**
- **テスト仕様書作成** (品質担当者が作成)
- **単体テスト実行** (開発者とは別の担当者が実行)
- **統合テスト実行** (品質担当者が実行)
- **負荷テスト実行** (品質担当者が実行)
- **テスト結果の記録・評価**

## 各タスクの詳細仕様

### タスク1: プロジェクト基盤構築
- **成果物**: 動作するGo Echoアプリケーション、MariaDB接続確認
- **技術要件**: Echo v4, MariaDB 10.11, Squirrel SQLビルダー, Go 1.24.4
- **完了条件**: Hello World APIが動作し、データベース接続が確認できる

### タスク2: 認証システム実装
- **成果物**: ログイン/ログアウト機能、JWT発行・検証
- **技術要件**: JWT, bcrypt, メールアドレス認証
- **完了条件**: 3つの権限（管理者/教員/学生）でログインできる

### タスク3: 基本データモデル実装
- **成果物**: 5つの基本テーブルとCRUD API
- **技術要件**: Squirrel使用、適切なリレーション設計
- **完了条件**: 全テーブルでCRUD操作が可能

### タスク12: テスト仕様書作成・テスト実行
- **成果物**: テスト仕様書、テスト実行結果レポート
- **技術要件**: 以下の形式でのテスト仕様書作成
- **完了条件**: 全機能のテストが完了し、品質が確認される

## 決定済み機能要件

### ユーザー種別と権限
1. **変更管理者**: 承認・差戻し、全体管理、授業回数チェック、CSV操作、通知操作
2. **変更申請者（教員）**: 授業変更申請、重複チェック、時間割確認
3. **学生**: 最新時間割の閲覧、通知の受け取り

### 重複チェック機能
- 同一教員の時間重複チェック
- 同一クラスの時間重複チェック
- 授業場所の重複チェック
- リアルタイムエラー表示

### CSV機能仕様
- **担当者CSV**: 科目コード, クラス, 授業場所, 科目名, 科目区分, 担当者1-3
- **時間割CSV**: クラス, 月1-4, 火1-4, 水1-4, 木1-4, 金1-4
- インポート/エクスポート両対応
- 処理時間5秒以内

### メール通知仕様
- 申請時の関係者通知
- 承認/却下時の通知
- 時間割変更時の一斉通知
- HTMLメール対応

## 制約事項・注意点

### 技術制約
- API応答時間: 1秒以内
- ページロード時間: 3秒以内
- 同時接続: 通常100ユーザー、ピーク500ユーザー
- 稼働率: 99.5%以上

### 業務制約
- 対象: 5学年×5クラス
- 授業時間: 月～金、最大4コマ/日
- 開講期間: 前期/後期/通年
- 授業回数: 前期・後期15回以上、通年30回以上

### 開発制約
- 納期: プロトタイプ6月上旬、完成7月下旬
- 段階的開発の厳守
- 各フェーズでの動作確認必須

### セキュリティ制約
- JWT認証必須
- パスワードハッシュ化必須
- 権限チェック必須
- HTTPS通信推奨

### **テスト制約**
- **テスト作成者とテスト実施者は原則別人とする**
- **開発者とテスト実施者は別人とする**
- **テスト仕様書は以下の形式で作成する**

## テスト仕様書フォーマット

### 必須項目
- **No**: テスト番号
- **区分**: テスト対象の機能区分
- **テスト手順**: 具体的な操作手順
- **期待される結果**: 期待する動作・表示内容
- **テスト結果**: 実際の結果
- **結果**: ○/×/△の判定
- **についての備考コメント**: 詳細な備考
- **テスト作成者**: テスト仕様を作成した担当者
- **対象部分開発者**: 該当機能の開発担当者
- **テスト実施者**: 実際にテストを実行した担当者

### テスト担当者の役割分担
- **品質担当者**: テスト仕様書作成、テスト実施
- **開発担当者**: 機能実装、修正対応
- **テスト作成者**: C,D列（テスト結果、結果判定）を記入
- **テスト実施者**: E,F列（備考、コメント）を記入

## データベース設計概要

### 主要テーブル
1. **users**: ユーザー情報（ID, email, password_hash, role, name）
2. **subjects**: 科目情報（ID, code, name, term, credits）
3. **classes**: クラス情報（ID, grade, class_name）
4. **timetables**: 時間割情報（ID, class_id, subject_id, teacher_id, day, period, room）
5. **change_requests**: 変更申請（ID, requester_id, status, request_data, created_at）
6. **notifications**: 通知履歴（ID, user_id, message, sent_at, read_at）

### リレーション
- users ← change_requests (申請者)
- subjects ← timetables (科目)
- classes ← timetables (クラス)
- users ← notifications (通知先)

## API設計概要

### 認証API
- POST /api/auth/login
- POST /api/auth/logout
- GET /api/auth/me
- POST /api/auth/change-password

### 時間割API
- GET /api/timetables
- GET /api/timetables/:id
- POST /api/timetables (管理者のみ)
- PUT /api/timetables/:id (管理者のみ)

### 申請API
- GET /api/requests
- GET /api/requests/:id
- POST /api/requests (教員のみ)
- PUT /api/requests/:id/approve (管理者のみ)
- PUT /api/requests/:id/reject (管理者のみ)

### CSV API
- POST /api/csv/import/subjects
- POST /api/csv/import/timetables
- GET /api/csv/export/timetables

### 通知API
- GET /api/notifications
- PUT /api/notifications/:id/read
- POST /api/notifications/send (管理者のみ)

## 重要な実装ポイント

1. **重複チェックロジック**: 複雑なSQL文をSquirrelで構築
2. **承認フロー**: 状態管理とトランザクション処理
3. **メール送信**: 非同期処理とエラーハンドリング
4. **CSV処理**: 大量データの効率的な処理
5. **性能最適化**: インデックス設計とクエリ最適化

## テスト仕様書サンプル

以下の形式でテスト仕様書を作成します：

| No | 区分 | テスト手順 | 期待される結果 | テスト結果 | 結果 | についての備考コメント | テスト作成者 | 対象部分開発者 | テスト実施者 |
|----|------|------------|----------------|------------|------|----------------------|--------------|----------------|--------------|
| 1 | ログイン画面 | ログインボタンを押下 | データ通りの正しいダッシュボードが表示される | データ通りの正しいダッシュボードが表示された | ○ | | 品質 太郎 | 開発 太郎 | 品質 太郎 |
| 2 | ダッシュボード | 時間割表示ボタンを押下 | 時間割一覧画面に遷移する | 時間割一覧画面に遷移した | ○ | | 品質 太郎 | 開発 太郎 | 品質 次郎 |
| 3 | 時間割一覧 | 申請作成ボタンを押下 | 申請データ入力フォームに遷移する | 申請データ入力フォームに遷移した | ○ | | 品質 太郎 | 開発 花子 | 品質 次郎 |
| 4 | 申請フォーム | 申請フォーム送信ボタンを押下 | 申請確認画面に遷移する | 申請確認画面に遷移した | ○ | | 品質 太郎 | 開発 花子 | 品質 次郎 |
| 5 | CSV機能 | CSVインポートボタンを押下 | CSV取り込み画面に遷移する | CSV取り込み画面に遷移しなかった | × | 修正後再テスト | 品質 太郎 | 開発 三郎 | 品質 次郎 |
| 6 | 重複チェック | 重複する時間で申請送信 | 重複エラーメッセージが表示される | 重複エラーメッセージが表示された | ○ | | 品質 太郎 | 開発 花子 | 品質 次郎 |
| 7 | 申請データ入力 | 申請フォームにて、データ入力欄がすべて埋まった状態で次の画面に遷移するか | 入力欄がすべて仕様上問題ない文字列が入力されている場合は正しく遷移し、空欄がある場合や仕様外の文字が入力された場合にエラーメッセージが表示される | 入力欄がすべて仕様上問題ない文字列が入力されている場合は正しく遷移し、空欄がある場合や仕様外の文字が入力された場合にエラーメッセージが表示された | ○ | | 品質 次郎 | 開発 花子 | 品質 次郎 |
| 8 | 申請承認機能 | 申請の各項目を確認し、承認ボタンを押下 | 申請データがデータベースで承認済みに更新され、仕様外の操作の場合はエラーが表示される | 申請データがデータベースで承認済みに更新され、仕様外の操作の場合はエラーが表示された | ○ | | 品質 次郎 | 開発 三郎 | 品質 太郎 |
| 9 | メール通知機能 | 申請承認後、通知送信ボタンを押下 | 関係者にメール通知が送信され、送信失敗の場合はエラーが表示される | 関係者にメール通知が送信され、送信失敗の場合はエラーが表示された | ○ | | 品質 次郎 | 開発 四郎 | 品質 次郎 |

### テスト実施ルール

1. **テスト作成者**: 品質担当者がテスト仕様を作成
2. **開発者**: 各機能の実装担当者（テスト実施は行わない）
3. **テスト実施者**: 開発者とは別の品質担当者が実施
4. **記入ルール**:
   - **C,D列（テスト結果、結果判定）**: テスト作成者が記入
   - **E,F列（備考、コメント）**: テスト実施者が記入
5. **判定基準**:
   - **○**: 期待通りの結果
   - **×**: 期待と異なる結果（修正が必要）
   - **△**: 一部問題があるが運用可能

### テスト対象機能一覧

1. **認証機能**: ログイン、ログアウト、権限チェック
2. **時間割表示機能**: 一覧表示、フィルタリング、詳細表示
3. **申請機能**: 申請作成、重複チェック、申請送信
4. **承認機能**: 申請一覧、承認/却下、状態更新
5. **CSV機能**: インポート、エクスポート、バリデーション
6. **メール通知機能**: 申請通知、承認通知、一斉通知
7. **授業回数チェック機能**: 回数カウント、不足アラート
8. **学生機能**: 時間割閲覧、通知受信
9. **管理機能**: ユーザー管理、システム設定
10. **性能テスト**: 応答時間、同時接続、負荷テスト

## 開発完了の定義

### 各タスクの完了条件
- **機能実装完了**: 仕様通りの動作確認
- **単体テスト完了**: 開発者による基本動作確認
- **品質テスト完了**: 品質担当者によるテスト仕様書に基づくテスト
- **修正対応完了**: 発見された不具合の修正とテスト
- **ドキュメント完成**: API仕様書、操作マニュアルの作成

### システム全体の完了条件
- **全機能のテスト完了**: テスト仕様書の全項目が○判定
- **性能要件達成**: API応答1秒以内、ページロード3秒以内
- **セキュリティ確認**: 認証、権限、データ保護の確認
- **運用準備完了**: デプロイ手順、バックアップ手順の確認

---

**注意**: このドキュメントは開発の基準となります。仕様変更が必要な場合は必ず確認を取ってから実装してください。

**最終更新**: テスト仕様書フォーマットと実施ルールを追加
